# Docker Compose Layout (Local)

This layout documents the actual Docker Compose file and client configs now present in the repo. Genesis and validator artifacts are generated via scripts in `scripts/` before running.

## Compose File

`docker-compose.yml`

```yaml
services:
  nethermind-validator:
    image: nethermind/nethermind:latest
    command:
      - "--config"
      - "/config/validator.json"
      - "--data-dir"
      - "/data"
    volumes:
      - ./config/nethermind:/config:ro
      - ./data/nethermind-validator:/data
      - ./secrets/jwt.hex:/jwt.hex:ro
    ports:
      - "8546:8545"  # validator JSON-RPC
    networks:
      - ethnet

  teku-validator:
    image: consensys/teku:latest
    command:
      - "--config-file"
      - "/config/teku/validator.yaml"
    volumes:
      - ./config/teku:/config/teku:ro
      - ./data/teku-validator:/data
      - ./secrets/jwt.hex:/jwt.hex:ro
      - ./secrets/validator-keys:/keys
      - ./secrets/validator-passwords:/passwords
    depends_on:
      - nethermind-validator
    networks:
      - ethnet

  nethermind-archive:
    image: nethermind/nethermind:latest
    command:
      - "--config"
      - "/config/archive.json"
      - "--data-dir"
      - "/data"
    volumes:
      - ./config/nethermind:/config:ro
      - ./data/nethermind-archive:/data
      - ./secrets/jwt.hex:/jwt.hex:ro
    ports:
      - "8545:8545"  # archive JSON-RPC
    networks:
      - ethnet

  teku-archive:
    image: consensys/teku:latest
    command:
      - "--config-file"
      - "/config/teku/archive.yaml"
    volumes:
      - ./config/teku:/config/teku:ro
      - ./data/teku-archive:/data
      - ./secrets/jwt.hex:/jwt.hex:ro
    depends_on:
      - nethermind-archive
    networks:
      - ethnet

networks:
  ethnet:
    driver: bridge
```

## Nethermind Configs

### `config/nethermind/validator.json`

```json
{
  "Init": {
    "ChainSpecPath": "/config/chainspec.json"
  },
  "JsonRpc": {
    "Enabled": true,
    "Host": "0.0.0.0",
    "Port": 8545,
    "EngineHost": "0.0.0.0",
    "EnginePort": 8551,
    "JwtSecretFile": "/jwt.hex",
    "EnabledModules": ["Eth", "Net", "Web3", "TxPool"]
  }
}
```

### `config/nethermind/archive.json`

```json
{
  "Init": {
    "ChainSpecPath": "/config/chainspec.json"
  },
  "Pruning": {
    "Mode": "None"
  },
  "Bloom": {
    "Index": true
  },
  "JsonRpc": {
    "Enabled": true,
    "Host": "0.0.0.0",
    "Port": 8545,
    "EngineHost": "0.0.0.0",
    "EnginePort": 8551,
    "JwtSecretFile": "/jwt.hex",
    "EnabledModules": ["Eth", "Net", "Web3", "Debug", "Trace", "TxPool"]
  }
}
```

## Required Inputs

- `config/nethermind/chainspec.json`, `config/nethermind/genesis.json`, `config/teku/genesis.ssz`, and `config/teku/config.yaml` are generated by `scripts/generate-genesis.sh`.
- Validator keys and password files must be provided under `secrets/validator-keys` and `secrets/validator-passwords` (see `scripts/generate-keys.sh`).
- JWT secret shared by EL and CL clients (see `scripts/generate-jwt.sh`).

## Doc-verified Flags

- Nethermind pruning mode (`Pruning.Mode`), JSON-RPC enable/host/port, Engine API host/port, JWT secret file, and ChainSpecPath are from Nethermind docs.
- Teku flags are from the Teku CLI reference: `--network` (accepts built-in name or file path), `--genesis-state`, `--data-path`/`--data-base-path`, `--ee-endpoint`, `--ee-jwt-secret-file`, and `--validator-keys`.

## Genesis Generator Config

- `config/genesis/el/genesis-config.yaml` and `config/genesis/cl/*` are from ethpandaops/ethereum-genesis-generator examples.
- `config/genesis/values.env.example` controls chain ID, validator count, and timing for the generated genesis.
